<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
        <link rel="stylesheet" href="main.css">
        <title>Swiftle Bot</title>
        <script src="https://telegram.org/js/telegram-web-app.js"></script>

        <link href="https://fonts.googleapis.com/css2?family=Electrolize&family=Roboto:wght@100;400;500;700;900&family=Ubuntu:wght@300;400;500;700&display=swap" rel="stylesheet">

        <script>
            if(!window.Telegram.WebApp.isExpanded) window.Telegram.WebApp.expand();
        </script>
    </head>

    <body>

        <div class="card cardquestion-inp">
            <p>Project name</p>
            <input id="project_name" class="inp" type="text" placeholder="Type something...">
        </div>

        <div class="card cardquestion-inp">
            <p>What is the result that you want to achieve with this project?</p>
            <input id="describe" class="inp" type="text" placeholder="Type something...">
        </div>

        <div class="card cardquestion-inp">
            <p>References links</p>
            <input id="reference" class="inp" type="text" placeholder="Type something...">
        </div>

        <div class="card cardquestion-inp">
            <p>What do you like in these examples</p>
            <input id="reference_like" class="inp" type="text" placeholder="Type something...">
        </div>

        <div class="card cardquestion-inp">
            <p>What don't you like in these examples</p>
            <input id="reference_dislike" class="inp" type="text" placeholder="Type something...">
        </div>

        <div class="card cardquestion-switch">
            <p>Please select one or more of the following that best describes your project</p>
            <div class="checklist">
                <div class="checkbox-card">
                    <input class="custom-checkbox" type="checkbox" id="mobile_app">
                    <label for="mobile_app">Mobile App</label>
                </div>
                <div class="checkbox-card">
                    <input class="custom-checkbox" type="checkbox" id="web_app">
                    <label for="web_app">Web App</label>
                </div>
                <div class="checkbox-card">
                    <input class="custom-checkbox" type="checkbox" id="automation">
                    <label for="automation">Automation</label>
                </div>
                <div class="checkbox-card">
                    <input class="custom-checkbox" type="checkbox" id="software">
                    <label for="software">Software</label>
                </div>
                <div class="checkbox-card">
                    <input class="custom-checkbox" type="checkbox" id="design">
                    <label for="design">Design</label>
                </div>
                <div class="checkbox-card">
                    <input class="custom-checkbox" type="checkbox" id="idk">
                    <label for="idk">I don't know</label>
                </div>
            </div>
        </div>

        <div class="card cardquestion-upload">
            <p>File</p>
            <input id="file" class="inp" type="file" placeholder="File">
        </div>

        <div class="card cardquestion-area">
            <p>Project info (Including URLs)</p>
            <textarea id="info" class="inp" placeholder="Type something..." rows="5"></textarea>
        </div>

        <div class="card cardquestion-select">
            <p>Do you need design?</p>
            <select id="need_design" class="inp" name="price">
                <option value="true">Yes</option>
                <option value="false">No</option>
            </select>
        </div>

        <div class="card cardquestion-select">
            <p>What is your budget range for the project?</p>
            <select id="cost" class="inp" name="price">
                <option value="2500-5000">$2500 - $5000</option>
                <option value="5000-10000">$5000 - $10000</option>
                <option value="10000+">$10000+</option>
            </select>
        </div>

        <div class="card cardquestion-inp">
            <p>Enter your Email</p>
            <input id="email" required class="inp" type="email" placeholder="Type something...">
        </div>

        <div class="card cardquestion-inp">
            <button id="test">Click me</button>
        </div>

    </body>

    <script>
        window.Telegram.WebApp.MainButton.text = 'Create project!';
        window.Telegram.WebApp.MainButton.show();

        let send_post = (url, objects) => {
            let json = JSON.stringify(objects);
            let xhr = new XMLHttpRequest();
            xhr.open("POST", url);
            xhr.setRequestHeader("Accept", "application/json");
            xhr.setRequestHeader("Content-Type", "application/json");
            xhr.onload = () => console.log(xhr.responseText);
            xhr.send(json);
        };

        window.Telegram.WebApp.MainButton.click(() => {
            let data = {
                "project_name": document.getElementById("project_name").value,
                "describe": document.getElementById("describe").value,
                "reference": document.getElementById("reference").value,
                "reference_like": document.getElementById("reference_like").value,
                "reference_dislike": document.getElementById("reference_dislike").value,
                "checkboxes": {
                    "mobile_app": document.getElementById("mobile_app").checked,
                    "web_app": document.getElementById("web_app").checked,
                    "automation": document.getElementById("automation").checked,
                    "software": document.getElementById("software").checked,
                    "design": document.getElementById("design").checked,
                    "idk": document.getElementById("idk").checked
                },
                "info": document.getElementById("info").value,
                "need_design": (document.getElementById("need_design").value === 'true'),
                "cost": document.getElementById("cost").value
            }

            /*
            let files = document.getElementById("file").files
            let filedata = {};
            if (files.length > 0) {
                files.forEach((file) => {
                    let reader = new FileReader();
                    reader.readAsText(file, "UTF-8");
                    reader.onload = (evt) => {
                        filedata[document.getElementById("file").files[0].name] = evt.target.result
                    }
                    reader.onerror = (evt) => {
                        console.log('[Swiftle] Error uploading file.')
                    }
                });
            }
            data["files"] = filedata;
             */

            console.log(data);
            let telegram_id = JSON.parse(new URLSearchParams(window.Telegram.WebApp.initData).get('user')).id;
            let email = document.getElementById("email").value;
            console.log(telegram_id, email);
            send_post("https://api.swiftle.io/createProject?telegram_id="+telegram_id.toString()+"&email="+email, data);
        });

    </script>

    <script src="//cdn.jsdelivr.net/npm/eruda"></script>
    <script>eruda.init();</script>

</html>